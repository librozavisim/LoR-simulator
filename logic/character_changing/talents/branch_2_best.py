import random

from logic.character_changing.passives.base_passive import BasePassive
from core.logging import logger, LogLevel  # [NEW] Import


# ==========================================
# 2.1 –ü—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π
# ==========================================
class TalentRemarkable(BasePassive):
    id = "remarkable"
    name = "–ü—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π"
    description = (
        "2.1 –ò–∑-–∑–∞ –≤–∞—à–µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ, –≤–∞—à–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—è –Ω–∞–±–∏—Ä–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, "
        "—á—Ç–æ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –¥–∞—Å—Ç –±–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–∏–π –∏ –±–æ–ª—å—à–µ —Å–≤—è–∑–µ–π."
    )
    is_active_ability = False

# ==========================================
# 2.2 –ù–∞ –≤–æ–ª–Ω–µ —É—Å–ø–µ—Ö–∞
# ==========================================
class TalentOnTheWaveOfSuccess(BasePassive):
    id = "on_the_wave_of_success"
    name = "–ù–∞ –≤–æ–ª–Ω–µ —É—Å–ø–µ—Ö–∞"
    description = (
        "2.2 –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –†–∞—Å—Å—É–¥–æ–∫ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è (–í–ø–ª–æ—Ç—å –¥–æ 30%).\n"
        "–¢–∞–∫–∂–µ, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∏ –≤–∞—à –†–∞—Å—Å—É–¥–æ–∫ –≤—ã—à–µ 90%, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +4 –•–∞—Ä–∏–∑–º—ã (–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—è)."
    )
    is_active_ability = False  # –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ª–µ—á–∏—Ç—å SP –∫–Ω–æ–ø–∫–æ–π

    def on_calculate_stats(self, unit) -> dict:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ: SP > 90%
        if unit.max_sp > 0:
            ratio = unit.current_sp / unit.max_sp
            if ratio >= 0.9:
                return {"eloquence": 4}
        return {}


# ==========================================
# 2.3 –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
# ==========================================
class TalentTacticalAnalysis(BasePassive):
    id = "tactical_analysis"
    name = "–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑"
    description = (
        "2.3 –ü–∞—Å—Å–∏–≤–Ω–æ: –≤—ã –≤–∏–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ, –≤—ã–¥–µ—Ä–∂–∫—É, —Ä–∞—Å—Å—É–¥–æ–∫ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –≤—Ä–∞–≥–∞.\n"
        "–ê–∫—Ç–∏–≤–Ω–æ: –ë—Ä–æ—Å–æ–∫ –ú—É–¥—Ä–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n"
        "1-3: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.\n"
        "4-6: –ì—Ä—É–ø–ø–∞ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏.\n"
        "7-8: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏.\n"
        "9-10: –ú–∏–Ω/–º–∞–∫—Å —Å–∫–æ—Ä–æ—Å—Ç—å.\n"
        "11-13: –°–ª–∞–±—ã–µ –∫–∞—Ä—Ç—ã (I).\n"
        "14-16: –°—Ä–µ–¥–Ω–∏–µ –∫–∞—Ä—Ç—ã (II).\n"
        "17-20: –°–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã (III).\n"
        "20-24: –ú–æ—â–Ω—ã–µ –∫–∞—Ä—Ç—ã.\n"
        "25-30: –ü–æ–≤—ã—Å–∏—Ç –æ—Ç–∫–∞—Ç –∫–∞—Ä—Ç –≤—Ä–∞–≥–∞ –Ω–∞ 1 (–Ω–∞ 2 —Ä–∞—É–Ω–¥–∞).\n"
        "31-35: –†–∞—Å–∫—Ä–æ–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—ã–µ —É–º–µ–Ω–∏—è.\n"
        "36+: –£—è–∑–≤–∏–º–∞—è —Ç–æ—á–∫–∞ (–Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –£—è–∑–≤–∏–º–æ—Å—Ç—å, -25% —Å–æ–ø—Ä. –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞)."
    )
    is_active_ability = False


# ==========================================
# 2.4 –ò–∑—É—á–µ–Ω–∏–µ –ü–æ–≤–µ–¥–µ–Ω–∏—è
# ==========================================
#TODO –û–ø—è—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å
class TalentBehaviorStudy(BasePassive):
    id = "behavior_study"
    name = "–ò–∑—É—á–µ–Ω–∏–µ –ü–æ–≤–µ–¥–µ–Ω–∏—è"
    description = (
        "2.4 –í—ã –∑–Ω–∞–µ—Ç–µ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π –∫–∞–∫ —Å–≤–æ–∏ 5 –ø–∞–ª—å—Ü–µ–≤.\n"
        "–ü–∞—Å—Å–∏–≤–Ω–æ: –ï—Å–ª–∏ –≤–∞—à —Å–ª–æ—Ç –ü–£–°–¢–û–ô –∏ –≤–∞—à–∞ –°–∫–æ—Ä–æ—Å—Ç—å –≤—ã—à–µ –°–∫–æ—Ä–æ—Å—Ç–∏ –≤—Ä–∞–≥–∞ –Ω–∞ 8+,\n"
        "–≤—ã —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç–µ –∞—Ç–∞–∫—É—é—â–∏–µ –∫—É–±–∏–∫–∏ –≤—Ä–∞–≥–∞, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —ç—Ç–æ—Ç —Å–ª–æ—Ç."
    )
    is_active_ability = False

    def can_break_empty_slot(self, unit) -> bool:
        """–†–∞–∑—Ä–µ—à–∞–µ—Ç –ª–æ–º–∞—Ç—å –∫—É–±–∏–∫–∏ –≤—Ä–∞–≥–∞ –ø—É—Å—Ç—ã–º —Å–ª–æ—Ç–æ–º –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏."""
        logger.log(f"üß† Behavior Study: {unit.name} allowed to break enemy dice with empty slot", LogLevel.VERBOSE, "Talent")
        return True


# ==========================================
# 2.5 –ú–∞—Å—Ç–µ—Ä —Ä–µ—á–∏
# ==========================================
class TalentSpeechMaster(BasePassive):
    id = "speech_master"
    name = "–ú–∞—Å—Ç–µ—Ä —Ä–µ—á–∏"
    description = (
        "2.5 –¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –∫–æ—Å—Ç—å –±—Ä–æ—Å–∫–∞ –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—è —Ä–∞–≤–Ω—è–µ—Ç—Å—è 1d10+10.\n"
        "–¢–∞–∫–∂–µ —Å–∫–∏–¥–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 10%."
    )
    is_active_ability = False
    # –õ–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø–æ–∑–∂–µ –≤ –º–µ—Ö–∞–Ω–∏–∫–µ —Å–∫–∏–ª–ª—á–µ–∫–æ–≤


# ==========================================
# 2.6 –°–ª–µ–¥–æ–ø—ã—Ç
# ==========================================
class TalentPathfinder(BasePassive):
    id = "pathfinder"
    name = "–°–ª–µ–¥–æ–ø—ã—Ç"
    description = (
        "2.6 –í—ã –æ—Ç—á—ë—Ç–ª–∏–≤–æ –≤–∏–¥–∏—Ç–µ —Å–ª–µ–¥ –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–∏ 24 —á–∞—Å–æ–≤ (–±–µ–∑ –±—Ä–æ—Å–∫–∞).\n"
        "–¢–∞–∫–∂–µ –≤—ã –∑–Ω–∞–µ—Ç–µ –∫–∞–∫ –∑–∞–º–µ—Å—Ç–∏ —Å–ª–µ–¥: —Ç–µ –∫—Ç–æ –≤–∞—Å –∏—â—É—Ç, –¥–æ–ª–∂–Ω—ã –∫–∏–¥–∞—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç —Å –ø–æ–º–µ—Ö–æ–π."
    )
    is_active_ability = False


# ==========================================
# 2.7 –¢—É–∑ –≤—Å–µ—Ö –º–∞—Å—Ç–µ–π
# ==========================================
class TalentAceOfAllTrades(BasePassive):
    id = "ace_of_all_trades"
    name = "–¢—É–∑ –≤—Å–µ—Ö –º–∞—Å—Ç–µ–π"
    description = "2.7 –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +3 –∫–æ –≤—Å–µ–º –∞—Ç—Ä–∏–±—É—Ç–∞–º –∏ –Ω–∞–≤—ã–∫–∞–º."
    is_active_ability = False

    def on_calculate_stats(self, unit) -> dict:
        # –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É
        stats = {}
        for attr in unit.attributes: stats[attr] = 3
        for skill in unit.skills: stats[skill] = 3
        return stats


# ==========================================
# 2.8 –ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞
# ==========================================
class TalentKnowYourEnemy(BasePassive):
    id = "know_your_enemy"
    name = "–ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞"
    description = (
        "2.8 (–¢—Ä–µ–±—É–µ—Ç 20 –ú—É–¥—Ä–æ—Å—Ç–∏) –í –±–æ—é –≤—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç–µ –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞.\n"
        "–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–Ω–≥ –∞—Ç–∞–∫–∏ –Ω–∞ –≤–∞—Å, –≤—ã –µ—ë –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç–µ.\n"
        "–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã —ç—Ç–æ–≥–æ —Ä–∞–Ω–≥–∞ –ø—Ä–æ—Ç–∏–≤ –≤–∞—Å: +1 –∫–æ –≤—Å–µ–º –±—Ä–æ—Å–∫–∞–º –≤ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ (–º–∞–∫—Å +3).\n"
        "–ü—Ä–∏–±–∞–≤–∫–∞ –¥–µ—Ä–∂–∏—Ç—Å—è 1 –¥–µ–Ω—å."
    )
    is_active_ability = False


# ==========================================
# 2.9 –ê: –°—Ç—Ä–∞—Ç–µ–≥
# ==========================================
class TalentStrategist(BasePassive):
    id = "strategist"
    name = "–°—Ç—Ä–∞—Ç–µ–≥ (–ê)"
    description = (
        "2.9 –ê: –í –≤–∞—à–µ–π –≥–æ–ª–æ–≤–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–æ–∑–≥–æ–≤–æ–π —à—Ç–æ—Ä–º.\n"
        "–ö–æ–≥–¥–∞ –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ, —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –≤—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (+10 –∫ –±—Ä–æ—Å–∫—É).\n"
        "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å '–ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞': –≤—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç–µ –ø—Ä–∏–±–∞–≤–∫—É +1 –ø—Ä–æ—Ç–∏–≤ –∫–∞—Ä—Ç, —Ä–∞—Å–∫—Ä—ã—Ç—ã—Ö –ê–Ω–∞–ª–∏–∑–æ–º."
    )
    is_active_ability = False


# ==========================================
# 2.9 –ë: –í—Å–µ–≥–¥–∞ –Ω–∞ –≥–æ—Ç–æ–≤–µ
# ==========================================
class TalentAlwaysReady(BasePassive):
    id = "always_ready"
    name = "–í—Å–µ–≥–¥–∞ –Ω–∞ –≥–æ—Ç–æ–≤–µ (–ë)"
    description = (
        "2.9 –ë: –í—Å–µ –≤–∞—à–∏ –±—Ä–æ—Å–∫–∏ –∫–æ—Å—Ç–µ–π (–ø–æ–º–∏–º–æ –±—Ä–æ—Å–∫–∞ —Ä–µ—á–∏) –±—É–¥—É—Ç —Ä–∞–≤–Ω—è—Ç—å—Å—è 1d12+8.\n"
        "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–∞–ª –≤–æ –≤—Ä–µ–º—è –±—Ä–æ—Å–∫–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω."
    )
    is_active_ability = False