import random

from logic.character_changing.passives.base_passive import BasePassive


# ==========================================
# 2.1 –ü—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π
# ==========================================
class TalentRemarkable(BasePassive):
    id = "remarkable"
    name = "–ü—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π"
    description = (
        "2.1 –ò–∑-–∑–∞ –≤–∞—à–µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ, –≤–∞—à–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—è –Ω–∞–±–∏—Ä–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, "
        "—á—Ç–æ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –¥–∞—Å—Ç –±–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–∏–π –∏ –±–æ–ª—å—à–µ —Å–≤—è–∑–µ–π."
    )
    is_active_ability = False

# ==========================================
# 2.2 –ù–∞ –≤–æ–ª–Ω–µ —É—Å–ø–µ—Ö–∞
# ==========================================
class TalentOnTheWaveOfSuccess(BasePassive):
    id = "on_the_wave_of_success"
    name = "–ù–∞ –≤–æ–ª–Ω–µ —É—Å–ø–µ—Ö–∞"
    description = (
        "2.2 –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –†–∞—Å—Å—É–¥–æ–∫ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è (–í–ø–ª–æ—Ç—å –¥–æ 30%).\n"
        "–¢–∞–∫–∂–µ, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∏ –≤–∞—à –†–∞—Å—Å—É–¥–æ–∫ –≤—ã—à–µ 90%, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +4 –•–∞—Ä–∏–∑–º—ã (–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—è)."
    )
    is_active_ability = True  # –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ª–µ—á–∏—Ç—å SP –∫–Ω–æ–ø–∫–æ–π

    def on_calculate_stats(self, unit) -> dict:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ: SP > 90%
        if unit.max_sp > 0:
            ratio = unit.current_sp / unit.max_sp
            if ratio >= 0.9:
                return {"eloquence": 4}
        return {}


# ==========================================
# 2.3 –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
# ==========================================
class TalentTacticalAnalysis(BasePassive):
    id = "tactical_analysis"
    name = "–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑"
    description = (
        "2.3 –ü–∞—Å—Å–∏–≤–Ω–æ: –≤—ã –≤–∏–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ, –≤—ã–¥–µ—Ä–∂–∫—É, —Ä–∞—Å—Å—É–¥–æ–∫ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –≤—Ä–∞–≥–∞.\n"
        "–ê–∫—Ç–∏–≤–Ω–æ: –ë—Ä–æ—Å–æ–∫ –ú—É–¥—Ä–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n"
        "1-3: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.\n"
        "4-6: –ì—Ä—É–ø–ø–∞ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏.\n"
        "7-8: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏.\n"
        "9-10: –ú–∏–Ω/–º–∞–∫—Å —Å–∫–æ—Ä–æ—Å—Ç—å.\n"
        "11-13: –°–ª–∞–±—ã–µ –∫–∞—Ä—Ç—ã (I).\n"
        "14-16: –°—Ä–µ–¥–Ω–∏–µ –∫–∞—Ä—Ç—ã (II).\n"
        "17-20: –°–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã (III).\n"
        "20-24: –ú–æ—â–Ω—ã–µ –∫–∞—Ä—Ç—ã.\n"
        "25-30: –ü–æ–≤—ã—Å–∏—Ç –æ—Ç–∫–∞—Ç –∫–∞—Ä—Ç –≤—Ä–∞–≥–∞ –Ω–∞ 1 (–Ω–∞ 2 —Ä–∞—É–Ω–¥–∞).\n"
        "31-35: –†–∞—Å–∫—Ä–æ–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—ã–µ —É–º–µ–Ω–∏—è.\n"
        "36+: –£—è–∑–≤–∏–º–∞—è —Ç–æ—á–∫–∞ (–Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –£—è–∑–≤–∏–º–æ—Å—Ç—å, -25% —Å–æ–ø—Ä. –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞)."
    )
    is_active_ability = True
    cooldown = 2  # –ü—É—Å—Ç—å –±—É–¥–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç–∫–∞—Ç

    def activate(self, unit, log_func, opponent=None):
        # –í —Å–∏–º—É–ª—è—Ç–æ—Ä–µ –º—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ –≤ –º–µ—Ç–æ–¥–µ activate,
        # –Ω–æ –≤ render_active_abilities (simulator_components) –º—ã –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º opponent.
        # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞ "–¢–µ–∫—É—â–µ–≥–æ –≤—Ä–∞–≥–∞"
        # (–≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ UI, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å opponent –≤ activate).
        # –ü–û–ö–ê –ß–¢–û —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ –±—Ä–æ—Å–æ–∫ –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ –≤ –ª–æ–≥.

        if unit.cooldowns.get(self.id, 0) > 0: return False

        wisdom = unit.attributes.get("wisdom", 0)
        roll = random.randint(1, 6)
        total = roll + wisdom

        unit.cooldowns[self.id] = self.cooldown

        msg = [f"üé≤ **–ê–Ω–∞–ª–∏–∑**: {roll} + {wisdom} (Wis) = **{total}**"]

        # –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        if total <= 3:
            msg.append("1-3: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.")
        elif total <= 6:
            msg.append("4-6: –ì—Ä—É–ø–ø–∞ / –ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è.")
        elif total <= 8:
            msg.append("7-8: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏.")
        elif total <= 10:
            msg.append("9-10: –ú–∏–Ω/–ú–∞–∫—Å —Å–∫–æ—Ä–æ—Å—Ç—å.")
        elif total <= 13:
            msg.append("11-13: –°–ª–∞–±—ã–µ –∫–∞—Ä—Ç—ã (Tier 1).")
        elif total <= 16:
            msg.append("14-16: –°—Ä–µ–¥–Ω–∏–µ –∫–∞—Ä—Ç—ã (Tier 2).")
        elif total <= 20:
            msg.append("17-20: –°–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã (Tier 3).")
        elif total <= 24:
            msg.append("20-24: –ú–æ—â–Ω—ã–µ –∫–∞—Ä—Ç—ã / EGO.")
        elif total <= 30:
            msg.append("üéØ **25-30: –°–ë–û–ô –°–ò–°–¢–ï–ú–´!**")
            msg.append("–í—Ä–∞–≥ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å 'Jamming': –û—Ç–∫–∞—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ +1 (2 —Ö–æ–¥–∞).")
            # –ß—Ç–æ–±—ã —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –≤—Ä–∞–≥–∞.
            # –í —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ UI –∫–Ω–æ–ø–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç –≤—Ä–∞–≥–∞.
            # –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –°–ï–ë–Ø —Å –ø–æ–º–µ—Ç–∫–æ–π "Aura",
            # –∞ –≤ clash.py –±—É–¥–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞—É—Ä—É –≤—Ä–∞–≥–∞.
            # –ò–õ–ò (–ü—Ä–∞–≤–∏–ª—å–Ω–µ–µ): –ú—ã –¥–æ–±–∞–≤–∏–º Opponent –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã activate —á—É—Ç—å –ø–æ–∑–∂–µ.
            # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ–º –ª–æ–≥.
        else:
            msg.append("‚ò†Ô∏è **36+: –£–Ø–ó–í–ò–ú–ê–Ø –¢–û–ß–ö–ê!**")
            msg.append("–í—Ä–∞–≥ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å 'Vulnerability': –ü–æ–ª—É—á–∞–µ–º—ã–π —É—Ä–æ–Ω +25%.")

        if log_func:
            for m in msg: log_func(m)

        return True

# ==========================================
# 2.4 –ò–∑—É—á–µ–Ω–∏–µ –ü–æ–≤–µ–¥–µ–Ω–∏—è
# ==========================================
class TalentBehaviorStudy(BasePassive):
    id = "behavior_study"
    name = "–ò–∑—É—á–µ–Ω–∏–µ –ü–æ–≤–µ–¥–µ–Ω–∏—è"
    description = (
        "2.4 –í—ã –∑–Ω–∞–µ—Ç–µ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π –∫–∞–∫ —Å–≤–æ–∏ 5 –ø–∞–ª—å—Ü–µ–≤.\n"
        "–ü–∞—Å—Å–∏–≤–Ω–æ: –µ—Å–ª–∏ –≤–∞—à —Ä–∞—Å—Å—É–¥–æ–∫ –≤—ã—à–µ 50%, –≤—ã –∑–Ω–∞–µ—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤–∞—à–∏—Ö –¥—Ä—É–∑–µ–π —Å –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å—é –º–∞–∫—Å–∏–º—É–º –≤ 50 –º–µ—Ç—Ä–æ–≤."
    )
    is_active_ability = False


# ==========================================
# 2.5 –ú–∞—Å—Ç–µ—Ä —Ä–µ—á–∏
# ==========================================
class TalentSpeechMaster(BasePassive):
    id = "speech_master"
    name = "–ú–∞—Å—Ç–µ—Ä —Ä–µ—á–∏"
    description = (
        "2.5 –¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –∫–æ—Å—Ç—å –±—Ä–æ—Å–∫–∞ –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—è —Ä–∞–≤–Ω—è–µ—Ç—Å—è 1d10+10.\n"
        "–¢–∞–∫–∂–µ —Å–∫–∏–¥–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 10%."
    )
    is_active_ability = False
    # –õ–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø–æ–∑–∂–µ –≤ –º–µ—Ö–∞–Ω–∏–∫–µ —Å–∫–∏–ª–ª—á–µ–∫–æ–≤


# ==========================================
# 2.6 –°–ª–µ–¥–æ–ø—ã—Ç
# ==========================================
class TalentPathfinder(BasePassive):
    id = "pathfinder"
    name = "–°–ª–µ–¥–æ–ø—ã—Ç"
    description = (
        "2.6 –í—ã –æ—Ç—á—ë—Ç–ª–∏–≤–æ –≤–∏–¥–∏—Ç–µ —Å–ª–µ–¥ –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–∏ 24 —á–∞—Å–æ–≤ (–±–µ–∑ –±—Ä–æ—Å–∫–∞).\n"
        "–¢–∞–∫–∂–µ –≤—ã –∑–Ω–∞–µ—Ç–µ –∫–∞–∫ –∑–∞–º–µ—Å—Ç–∏ —Å–ª–µ–¥: —Ç–µ –∫—Ç–æ –≤–∞—Å –∏—â—É—Ç, –¥–æ–ª–∂–Ω—ã –∫–∏–¥–∞—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç —Å –ø–æ–º–µ—Ö–æ–π."
    )
    is_active_ability = False


# ==========================================
# 2.7 –¢—É–∑ –≤—Å–µ—Ö –º–∞—Å—Ç–µ–π
# ==========================================
class TalentAceOfAllTrades(BasePassive):
    id = "ace_of_all_trades"
    name = "–¢—É–∑ –≤—Å–µ—Ö –º–∞—Å—Ç–µ–π"
    description = "2.7 –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +3 –∫–æ –≤—Å–µ–º –∞—Ç—Ä–∏–±—É—Ç–∞–º –∏ –Ω–∞–≤—ã–∫–∞–º."
    is_active_ability = False

    def on_calculate_stats(self, unit) -> dict:
        # –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É
        stats = {}
        for attr in unit.attributes: stats[attr] = 3
        for skill in unit.skills: stats[skill] = 3
        return stats


# ==========================================
# 2.8 –ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞
# ==========================================
class TalentKnowYourEnemy(BasePassive):
    id = "know_your_enemy"
    name = "–ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞"
    description = (
        "2.8 (–¢—Ä–µ–±—É–µ—Ç 20 –ú—É–¥—Ä–æ—Å—Ç–∏) –í –±–æ—é –≤—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç–µ –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞.\n"
        "–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–Ω–≥ –∞—Ç–∞–∫–∏ –Ω–∞ –≤–∞—Å, –≤—ã –µ—ë –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç–µ.\n"
        "–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞—Ä—Ç—ã —ç—Ç–æ–≥–æ —Ä–∞–Ω–≥–∞ –ø—Ä–æ—Ç–∏–≤ –≤–∞—Å: +1 –∫–æ –≤—Å–µ–º –±—Ä–æ—Å–∫–∞–º –≤ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ (–º–∞–∫—Å +3).\n"
        "–ü—Ä–∏–±–∞–≤–∫–∞ –¥–µ—Ä–∂–∏—Ç—Å—è 1 –¥–µ–Ω—å."
    )
    is_active_ability = False


# ==========================================
# 2.9 –ê: –°—Ç—Ä–∞—Ç–µ–≥
# ==========================================
class TalentStrategist(BasePassive):
    id = "strategist"
    name = "–°—Ç—Ä–∞—Ç–µ–≥ (–ê)"
    description = (
        "2.9 –ê: –í –≤–∞—à–µ–π –≥–æ–ª–æ–≤–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–æ–∑–≥–æ–≤–æ–π —à—Ç–æ—Ä–º.\n"
        "–ö–æ–≥–¥–∞ –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ, —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –≤—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (+10 –∫ –±—Ä–æ—Å–∫—É).\n"
        "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å '–ü–æ–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ –≤—Ä–∞–≥–∞': –≤—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç–µ –ø—Ä–∏–±–∞–≤–∫—É +1 –ø—Ä–æ—Ç–∏–≤ –∫–∞—Ä—Ç, —Ä–∞—Å–∫—Ä—ã—Ç—ã—Ö –ê–Ω–∞–ª–∏–∑–æ–º."
    )
    is_active_ability = False


# ==========================================
# 2.9 –ë: –í—Å–µ–≥–¥–∞ –Ω–∞ –≥–æ—Ç–æ–≤–µ
# ==========================================
class TalentAlwaysReady(BasePassive):
    id = "always_ready"
    name = "–í—Å–µ–≥–¥–∞ –Ω–∞ –≥–æ—Ç–æ–≤–µ (–ë)"
    description = (
        "2.9 –ë: –í—Å–µ –≤–∞—à–∏ –±—Ä–æ—Å–∫–∏ –∫–æ—Å—Ç–µ–π (–ø–æ–º–∏–º–æ –±—Ä–æ—Å–∫–∞ —Ä–µ—á–∏) –±—É–¥—É—Ç —Ä–∞–≤–Ω—è—Ç—å—Å—è 1d12+8.\n"
        "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–∞–ª –≤–æ –≤—Ä–µ–º—è –±—Ä–æ—Å–∫–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω."
    )
    is_active_ability = False