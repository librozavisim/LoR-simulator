from logic.character_changing.passives.base_passive import BasePassive


# ==========================================
# 12.1 –ü—Ä–æ–µ–∫—Ü–∏—è
# ==========================================
class TalentProjection(BasePassive):
    id = "projection"
    name = "–ü—Ä–æ–µ–∫—Ü–∏—è"
    description = (
        "12.1 –í—ã —É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.\n"
        "–î–æ—Å—Ç—É–ø –∫ –ü–µ—Ä–µ–Ω–æ—Å–Ω–æ–º—É –≤–µ—Ä—Å—Ç–∞–∫—É (–∫—Ä–∞—Ñ—Ç–∏–Ω–≥ –ª—é–±—ã—Ö —Ä–∞–Ω–≥–æ–≤)."
    )
    is_active_ability = True

    def activate(self, unit, log_func, **kwargs):
        if log_func: log_func("üõ†Ô∏è **–í–µ—Ä—Å—Ç–∞–∫**: –ú–µ–Ω—é –∫—Ä–∞—Ñ—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–æ (–ó–∞–≥–ª—É—à–∫–∞).")
        return True


# ==========================================
# 12.2 –•–∞–∫–µ—Ä
# ==========================================
class TalentHacker(BasePassive):
    id = "hacker"
    name = "–•–∞–∫–µ—Ä"
    description = (
        "12.2 –†–µ—Ü–µ–ø—Ç –í–≠–° (–í–∑–ª–æ–º –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –°–∏—Å—Ç–µ–º).\n"
        "–ê–∫—Ç–∏–≤–Ω–æ (–ö–∞—Ä—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—è): –í–∑–ª–æ–º (–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ vs –§–∞–π—Ä–≤–æ–ª).\n"
        "–£—Å–ø–µ—Ö: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–º–ø–ª–∞–Ω—Ç–æ–≤/–ø–∞—Å—Å–∏–≤–æ–∫ –≤—Ä–∞–≥–∞."
    )
    is_active_ability = True

    def activate(self, unit, log_func, **kwargs):
        # –ó–∞–≥–ª—É—à–∫–∞ –º–µ—Ö–∞–Ω–∏–∫–∏ –≤–∑–ª–æ–º–∞
        # –ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å, –∫–∏–Ω—É—Ç—å –¥–∞–π—Å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å
        prog = unit.skills.get("programming", 0)
        import random
        roll = random.randint(1, 20) + prog
        if log_func: log_func(f"üíª **–í–∑–ª–æ–º**: –ë—Ä–æ—Å–æ–∫ {roll} (1d20+{prog}).")
        return True


# ==========================================
# 12.3 Little Helper
# ==========================================
class TalentLittleHelper(BasePassive):
    id = "little_helper"
    name = "Little Helper"
    description = (
        "12.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤ (–ú–µ–¥-–±–æ—Ç, –¢—É—Ä–µ–ª—å, –í–∑–ª–æ–º-–±–æ—Ç, –ö—Ä–∞—Ñ—Ç–µ—Ä).\n"
        "–õ–∏–º–∏—Ç: 2 –±–æ—Ç–∞ (—Å 12.5 -> 3, —Å 12.7 -> 4).\n"
        "–ë–æ–Ω—É—Å—ã –∑–∞ –±–æ—Ç–æ–≤: –ú–µ–¥–∏—Ü–∏–Ω–∞/–û–≥–Ω–µ—Å—Ç—Ä–µ–ª/–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ/–ò–Ω–∂–µ–Ω–µ—Ä–∏—è +2 –∑–∞ –∫–∞–∂–¥–æ–≥–æ."
    )
    is_active_ability = True

    def activate(self, unit, log_func, **kwargs):
        if log_func: log_func("ü§ñ **–ú–µ–Ω—é –±–æ—Ç–æ–≤**: –°–æ–∑–¥–∞–Ω–∏–µ/–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ó–∞–≥–ª—É—à–∫–∞).")
        return True

    # –ë–æ–Ω—É—Å—ã –∫ —Å—Ç–∞—Ç–∞–º –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤.
    # –í —Å–∏–º—É–ª—è—Ç–æ—Ä–µ –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤" –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–æ.
    # –†–µ–∞–ª–∏–∑—É–µ–º –∫–∞–∫ –ø–∞—Å—Å–∏–≤–Ω—ã–π –±–æ–Ω—É—Å, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è –Ω–∞–ª–∏—á–∏–µ –±–æ—Ç–æ–≤.


# ==========================================
# 12.4 –ò–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
# ==========================================
class TalentProgrammingLanguages(BasePassive):
    id = "programming_languages"
    name = "–ò–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤"
    description = "12.4 –ë—Ä–æ—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å 1d10+10 (–≤–º–µ—Å—Ç–æ 1d20)."
    is_active_ability = False

    # –õ–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—É–±–∏–∫–∞ –Ω—É–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —Å–∫–∏–ª–ª—á–µ–∫–æ–≤.


# ==========================================
# 12.5 –ü–µ—Ä–µ–Ω–æ—Å–Ω–æ–π —â–∏—Ç
# ==========================================
class TalentPortableShield(BasePassive):
    id = "portable_shield"
    name = "–ü–µ—Ä–µ–Ω–æ—Å–Ω–æ–π —â–∏—Ç WIP"
    description = (
        "12.5 –°–æ–∑–¥–∞–Ω–∏–µ —â–∏—Ç–∞. –î–∞–µ—Ç –ë–∞—Ä—å–µ—Ä (% –æ—Ç HP) –∏ –†–µ–∑–∏—Å—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–Ω–≥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞.\n"
        "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç % –ë–∞—Ä—å–µ—Ä–∞ –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥.\n"
        "–õ–∏–º–∏—Ç –±–æ—Ç–æ–≤ +1."
    )
    is_active_ability = False

    def on_combat_start(self, unit, log_func, **kwargs):
        # –≠–º—É–ª—è—Ü–∏—è —â–∏—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞–Ω–≥–∞ (5 –†–∞–Ω–≥: 25% HP, 0.75 Resists, 3% Regen)
        shield_hp = int(unit.max_hp * 0.25)
        unit.add_status("barrier", shield_hp, duration=99)
        # –†–µ–∑–∏—Å—Ç—ã —â–∏—Ç–∞ —Å–ª–æ–∂–Ω–æ –Ω–∞–ª–æ–∂–∏—Ç—å –ø–æ–≤–µ—Ä—Ö —Ä–µ–∑–∏—Å—Ç–æ–≤ —é–Ω–∏—Ç–∞ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–ª–æ–µ–≤.
        # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –¥–∞–µ–º –±–∞—Ä—å–µ—Ä.
        if log_func: log_func(f"üõ°Ô∏è **–©–∏—Ç**: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (+{shield_hp} Barrier).")

    def on_round_end(self, unit, log_func, **kwargs):
        regen = int(unit.max_hp * 0.03)
        unit.add_status("barrier", regen, duration=99)  # Barrier —Å—Ç–∞–∫–∞–µ—Ç—Å—è
        if log_func: log_func(f"üõ°Ô∏è **–©–∏—Ç**: –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è +{regen}.")


# ==========================================
# 12.6 –ö—Ä—É–≥–æ–≤–æ—Ä–æ—Ç –≠–Ω–µ—Ä–≥–∏–∏
# ==========================================
class TalentEnergyCycle(BasePassive):
    id = "energy_cycle"
    name = "–ö—Ä—É–≥–æ–≤–æ—Ä–æ—Ç –≠–Ω–µ—Ä–≥–∏–∏"
    description = (
        "12.6 +1 HP –∑–∞ –∫–∞–∂–¥—ã–µ 10 –ó–∞—Ä—è–¥–∞ (Charge).\n"
        "–°–≤–µ—Ä—Ö–ª–∏–º–∏—Ç–Ω—ã–π –ó–∞—Ä—è–¥ -> –ë–∞—Ä—å–µ—Ä (1 Charge = 1% HP Barrier, –∏–ª–∏ 2% —Å 10.3 –ê)."
    )
    is_active_ability = False

    def on_round_start(self, unit, log_func, **kwargs):
        charge = unit.get_status("charge")
        # –õ–µ—á–µ–Ω–∏–µ
        heal_amt = charge // 10
        if heal_amt > 0:
            unit.heal_hp(heal_amt)

        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å–≤–µ—Ä—Ö–ª–∏–º–∏—Ç–∞ (–¥–æ–ø—É—Å—Ç–∏–º –ª–∏–º–∏—Ç 20, –≤—Å—ë —á—Ç–æ –≤—ã—à–µ - –≤ –±–∞—Ä—å–µ—Ä)
        limit = 20  # –£—Å–ª–æ–≤–Ω–æ
        if charge > limit:
            excess = charge - limit
            # –°–Ω–∏–º–∞–µ–º –ª–∏—à–Ω–µ–µ? –í –æ–ø–∏—Å–∞–Ω–∏–∏ "–ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è". –ü—É—Å—Ç—å —Å–Ω–∏–º–∞–µ–º.
            unit.remove_status("charge", excess)

            mult = 0.02 if "emergency_protection" in unit.talents else 0.01
            barrier = int(unit.max_hp * mult * excess)
            unit.add_status("barrier", barrier, duration=2)
            if log_func: log_func(f"‚ö° **–ö—Ä—É–≥–æ–≤–æ—Ä–æ—Ç**: {excess} Charge -> {barrier} Barrier.")


# ==========================================
# 12.7 –ú–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
# ==========================================
class TalentModulation(BasePassive):
    id = "modulation"
    name = "–ú–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ"
    description = (
        "12.7 –ú–æ–¥—É–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–π (–ü–æ—á–∏–Ω–∫–∞, SHIELD, –ú–∞—Ç–µ—Ä–∏–Ω–∫–∞, –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞, –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å).\n"
        "–õ–∏–º–∏—Ç –±–æ—Ç–æ–≤ +1.\n"
        "–ë–æ–Ω—É—Å—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Å –±–æ—Ç–æ–≤ +1.\n"
        "–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å: –ë–æ—Ç –¥–∞–µ—Ç –¥–æ–ø. –∫–æ—Å—Ç—å –∏ –Ω–µ—É—è–∑–≤–∏–º."
    )
    is_active_ability = True  # –ú–µ–Ω—é –º–æ–¥—É–ª–µ–π

    def activate(self, unit, log_func, **kwargs):
        if log_func: log_func("üîß **–ú–æ–¥—É–ª–∏**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π (–ó–∞–≥–ª—É—à–∫–∞).")
        return True


# ==========================================
# 12.8 –¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞
# ==========================================
class TalentAccessPoint(BasePassive):
    id = "access_point"
    name = "–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞"
    description = (
        "12.8 –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ (20–º). –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –±—Ä–æ—Å–∫–∞ –≤–∑–ª–æ–º–∞.\n"
        "–ü–æ—Å–ª–µ 3 –≤–∑–ª–æ–º–æ–≤: –ü–µ—Ä–µ–≥—Ä–µ–≤ (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∑—Ä—ã–≤ –ø—Ä–µ–¥–º–µ—Ç–∞)."
    )
    is_active_ability = False


# ==========================================
# 12.9 –û—à–∏–±–∫–∞ 404
# ==========================================
class TalentError404(BasePassive):
    id = "error_404"
    name = "–û—à–∏–±–∫–∞ 404"
    description = (
        "12.9 –£—Å–ø–µ—à–Ω—ã–π –≤–∑–ª–æ–º —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è -> –í—Ä–∞–≥ –ø–æ–ª—É—á–∞–µ—Ç 2 –ü–∞—Ä–∞–ª–∏—á–∞ –∏ 2 –•—Ä—É–ø–∫–æ—Å—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ."
    )
    is_active_ability = False

    # –õ–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —É—Å–ø–µ—à–Ω–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é Hacker.activate


# ==========================================
# 12.10 –í–∑–ª–æ–º –ñ–æ–ø—ã
# ==========================================
class TalentAssHack(BasePassive):
    id = "ass_hack"
    name = "–í–∑–ª–æ–º –ñ–æ–ø—ã (–í–≠–° 2.0)"
    description = (
        "12.10 –£–ª—É—á—à–µ–Ω–∏–µ –í–≠–° –∏ –¢–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞.\n"
        "–†–∞–¥–∏—É—Å 50–º. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –ª–æ–∫–∞—Ü–∏–∏.\n"
        "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞."
    )
    is_active_ability = False